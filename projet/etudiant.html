<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>√âtudiant</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script src="contract.js"></script>
</head>
<body>

<div class="container">
<h1>Dipl√¥me √âtudiant</h1>

<button onclick="connect()">Connecter MetaMask</button>
<p id="compte"></p>

<input id="hash" placeholder="Hash du dipl√¥me">
<button onclick="verifier()">V√©rifier</button>
<button onclick="goHome()">Retour √† l'accueil</button>

<p id="etat"></p>

<button id="printBtn" onclick="window.print()" style="display:none">
üñ®Ô∏è Imprimer le dipl√¥me
</button>
</div>

<!-- DIPL√îME OFFICIEL POUR IMPRESSION -->
<div id="diploma" class="diploma-container" style="display:none">
  <div class="diploma">
    <!-- BORDURE DECORATIVE -->
    <div class="diploma-border"></div>

    <!-- EN-T√äTE AVEC LOGOS -->
    <div class="diploma-top">
      <div class="diploma-logo-left">
        <img src="logo.png" alt="Logo ENIAD">
      </div>
      <div class="diploma-center-header">
        <h1 class="diploma-main-title">ATTESTATION DE DIPL√îME</h1>
        <p class="diploma-subtitle">√âcole Nationale de L'intelligence Artificielle et du Digital</p>
        <p class="diploma-subtitle-small">Sp√©cialit√© : Ing√©nierie R√©seaux et S√©curit√© Informatique</p>
      </div>
      <div class="diploma-logo-right">
        <img src="ÿ¥ÿπÿßÿ±_Ÿàÿ≤ÿßÿ±ÿ©_ÿßŸÑÿ™ÿ±ÿ®Ÿäÿ©_ÿßŸÑŸàÿ∑ŸÜŸäÿ©_ŸàÿßŸÑÿ™ÿπŸÑŸäŸÖ_ÿßŸÑÿ£ŸàŸÑŸä_ŸàÿßŸÑÿ±Ÿäÿßÿ∂ÿ©.png" alt="Logo Minist√®re">
      </div>
    </div>

    <!-- CORPS DU DIPL√îME -->
    <div class="diploma-body">
      <div class="diploma-reference">
        <p>N¬∞ <span id="diplomaNumber">----</span> / ENIAD / 2025</p>
        <p style="margin-top: 5px;"><strong>Dipl√¥me reconnu par le Minist√®re de l'√âducation</strong></p>
      </div>

      <div class="diploma-declaration">
        <p class="diploma-intro">
          Le Directeur de l'√âcole Nationale de L'intelligence Artificielle et du Digital, atteste que :
        </p>

        <p class="diploma-student-name" id="studentName">
          0x34953D90...98411ED7
        </p>

        <p class="diploma-text">
          Num√©ro √âtudiant : <span id="studentNumber">----</span>
        </p>

        <p class="diploma-text">
          D√ªment inscrit(e) √† l'√âcole Nationale de L'intelligence Artificielle et du Digital, a suivi r√©guli√®rement les cours du cursus de formation en <strong>Ing√©nierie R√©seaux et S√©curit√© Informatique</strong> et a r√©ussi avec succ√®s tous les examens requis.
        </p>

        <p class="diploma-text">
          En cons√©quence, il/elle a obtenu le <strong>Dipl√¥me d'Ing√©nieur d'√©tat</strong> <br>
          <span style="color: #8b7355; font-weight: 600;">Sp√©cialit√© : Ing√©nierie R√©seaux et S√©curit√© Informatique</span>
        </p>

        <p class="diploma-text">
          En foi de quoi, la pr√©sente attestation de dipl√¥me lui est d√©livr√©e pour servir et valoir ce que de droit.
        </p>

        <p class="diploma-date">
          Fait √† Berkane, le <span id="dateValue">--/--/----</span>
        </p>
      </div>

      <!-- SIGNATURES -->
      <div class="diploma-signatures">
        <div class="signature-box">
          <img src="signature-40132.png" alt="Signature Directeur" class="signature-img" />
          <p class="signature-line">___________________</p>
          <p class="signature-name">Le Directeur</p>
          <p class="signature-school">ENIAD</p>
        </div>

        <div class="signature-box">
          <img src="signature-40138.png" alt="Signature Pr√©sident" class="signature-img" />
          <p class="signature-line">____________________</p>
          <p class="signature-name">Le Pr√©sident</p>
          <p class="signature-school">Universit√© Mohamed Premier</p>
        </div>

        <div class="signature-box">
          <p style="font-size: 0.8rem; color: #666; word-break: break-all;">
            <strong>Hash Blockchain:</strong><br>
            <span id="diplomaHash" class="hash-mono">----</span>
          </p>
          <img src="qr-code.png" alt="QR Code" class="qr-img" />
        </div>
      </div>
    </div>

    <!-- PIED DE PAGE -->
    <div class="diploma-footer">
      <p>√âcole Nationale de L'intelligence Artificielle et du Digital ‚Ä¢ Berkane, Maroc ‚Ä¢ Certifi√©e ISO 9001:2015</p>
    </div>
  </div>
</div>

<script>
let web3, contract, account;

async function connect() {
  web3 = new Web3(window.ethereum);
  const acc = await ethereum.request({ method: "eth_requestAccounts" });
  account = acc[0];
  document.getElementById("compte").innerText = account;
  contract = new web3.eth.Contract(abi, contractAddress);
}

async function verifier() {
  const hash = document.getElementById("hash").value;

  const acces = await contract.methods.verifierAccesEtudiant(hash)
    .call({ from: account });

  if (!acces) {
    alert("‚ùå Ce dipl√¥me ne vous appartient pas");
    return;
  }

  const etat = await contract.methods.getEtatCertificat(hash).call();
  document.getElementById("printBtn").style.display = "none";
  document.getElementById("diploma").style.display = "none";

  if (!etat[0] && !etat[1]) {
    document.getElementById("etat").innerText = "‚è≥ En attente des deux signatures";
  } else if (etat[0] && !etat[1]) {
    document.getElementById("etat").innerText = "‚è≥ En attente du pr√©sident";
  } else if (!etat[0] && etat[1]) {
    document.getElementById("etat").innerText = "‚è≥ En attente du directeur";
  } else {
    document.getElementById("etat").innerText = "‚úÖ Dipl√¥me valide";
    document.getElementById("printBtn").style.display = "block";
    showDiploma(hash);
  }
}

function showDiploma(hash) {
  document.getElementById("diploma").style.display = "block";
  const date = new Date();
  const formattedDate = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
  
  // Afficher le hash complet
  document.getElementById("diplomaHash").innerText = hash;
  document.getElementById("dateValue").innerText = formattedDate;
  document.getElementById("diplomaNumber").innerText = "ENIAD-21721000 / ENIAD / 2025";
  
  // R√©cup√©rer le nom de l'√©tudiant du localStorage
  const studentName = localStorage.getItem("diploma_" + hash);
  
  if (studentName) {
    document.getElementById("studentName").innerText = studentName;
  } else {
    document.getElementById("studentName").innerText = "Nom non disponible";
  }
  
  // Afficher l'adresse comme num√©ro √©tudiant dans le corps
  document.getElementById("studentNumber").innerText = account;
}

function goHome() {
  window.location.href = "index.html";
}
</script>

</body>
</html>
